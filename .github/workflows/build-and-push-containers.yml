name: Build and Push Containers
run-name: ${{ github.actor }} is building and pushing Docker Containers üöÄ
on: push
jobs:
  build-and-push:
    environment: test
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository code
        uses: actions/checkout@v4
      - name: Convert all Secrets to Env Variables
        uses: oNaiPs/secrets-to-env-action@v1
        with:
          secrets: ${{ toJSON(secrets) }}
      - run: echo "Value of FRONTEND_USERNAME $(FRONTEND_USERNAME)"
      - name: Building Docker Compose Containers
        run: docker-compose -f docker-compose.local.yml build
      - name: Configure AWS credentials from Test account
        uses: aws-actions/configure-aws-credentials@v4
        with:
          role-to-assume: arn:aws:iam::306210296691:role/GitHubActionsECRPushPull
          aws-region: us-east-1
      - name: Login to AWS ECR
        id: login-ecr-public
        uses: aws-actions/amazon-ecr-login@v1
        with:
          registry-type: public
      - name: Push Backend Container
        env:
          REPOSITORY: mock-ai-interviewer-backend
        run: |
          docker tag $REPOSITORY:latest ${{ steps.login-ecr-public.outputs.registry }}/$REPOSITORY
          docker push ${{ steps.login-ecr-public.outputs.registry }}/$REPOSITORY
      - name: Push Frontend Container
        env:
          REPOSITORY: mock-ai-interviewer-frontend
        run: |
          docker tag $REPOSITORY:latest ${{ steps.login-ecr-public.outputs.registry }}/$REPOSITORY
          docker push ${{ steps.login-ecr-public.outputs.registry }}/$REPOSITORY
      - run: echo "üçè Build and Push job's status is ${{ job.status }}."
